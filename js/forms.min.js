/**
 *  @author: Isaac Vega Rodriguez          <isaacvega1996@gmail.com>
 */
function Form(e,t){"use strict"
if(!(this instanceof Form))return new Form(e,t)
var r=this
r._target=null,r._src=null,r._obj=null,r._events=["load","completed"],r._callbacs={},r._triggeredEvents=[],r._answeredCallbacs={},r.formObj={},r._pageRequirements={},r._lastArgumentOf={},r._componentList=["input","radio","checkbox","radioMatrix","checkboxMatrix","plainText"],r._defaultErrorMessage="This field is required. Please, fill it."
for(var n=0;n<r._events.length;n+=1)r._callbacs[r._events[n]]=[],r._answeredCallbacs[r._events[n]]=!1
if(arguments.length<2)throw new ReferenceError("Constructor must have at least 2 arguments")
if(!(arguments[0]instanceof HTMLDivElement))throw new TypeError("First element must be a <div> element")
if("string"!=typeof arguments[1])throw new TypeError("String expected as second argument")
r.setTarget(arguments[0]),r.setSource(arguments[1])}Form._components={__from_items:function(e,t,r,n){var a=document
n.formObj[r.name]=null
for(var o=0;o<r.items.length;o+=1)!function(o,i){var s=a.createElement("li"),l=a.createElement("input"),m=a.createElement("span")
l.setAttribute("type",t),l.setAttribute("name",r.name||""),l.setAttribute("itemNumber",i.toString())
var c=function(){"radio"===t?n.formObj[r.name]=o:"checkbox"===t&&(!0===l.checked?(n.formObj[r.name]=n.formObj[r.name]||[],n.formObj[r.name].push(o)):n.formObj[r.name].splice(n.formObj[r.name].indexOf(o),1))}
l.addEventListener("click",c,!1),m.className="form-input-descriptor",m.innerHTML=o,m.addEventListener("click",function(){"radio"===t?(l.checked=!0,c()):"checkbox"===t&&(l.checked=!l.checked,c())},!1),s.appendChild(l),s.appendChild(m),e.appendChild(s)}(r.items[o],o)},__from_matrix:function(e,t,r,n,a){a=a||[]
var o=document
!function(){var e=n._pageRequirements[n._pages-1].indexOf(r.name)
n._pageRequirements[n._pages-1][e]={name:r.name,requirements:[]}
var t
if(a.indexOf("col")>-1)for(t=0;t<r.cols.length;t+=1)n._pageRequirements[n._pages-1][e].requirements.push(r.cols[t].name)
else for(t=0;t<r.rows.length;t+=1)n._pageRequirements[n._pages-1][e].requirements.push(r.rows[t].name)}(),n.formObj[r.name]={}
for(var i=n.formObj[r.name],s=function(e){var r=e.target,n=r.getAttribute("row"),o=r.getAttribute("col")
"radio"===t?a.indexOf("col")>-1?i[o]=n:i[n]=o:"checkbox"===t&&(a.indexOf("col")>-1?(i[o]=i[o]||[],!0===r.checked?i[o].push(n):(i[o].splice(i[o].indexOf(n),1),0===i[o].length&&delete i[o])):(i[n]=i[n]||[],!0===r.checked?i[n].push(o):(i[n].splice(i[n].indexOf(o),1),0===i[n].length&&delete i[n])))},l=0;l<r.rows.length;l+=1){var m=o.createElement("tr"),c=o.createElement("th")
c.innerHTML=r.rows[l].title||"",m.appendChild(c)
for(var p=0;p<r.cols.length;p+=1){var f=o.createElement("td"),d=o.createElement("input")
d.setAttribute("type",t),d.setAttribute("row",r.rows[l].name||""),d.setAttribute("col",r.cols[p].name||""),d.setAttribute("name",r.rows[l].name||""),d.addEventListener("click",s,!1),f.appendChild(d),m.appendChild(f)}e.appendChild(m)}},__basic_component:function(e,t){t._pageRequirements[t._pages-1].push(e.name)
var r=document,n=r.createElement("div"),a=r.createElement("h3"),o=r.createElement("p")
return n.className="form-"+e.type,a.className="form-title",o.className="form-subtitle",a.innerHTML=e.title||"",o.innerHTML=e.subtitle||"",n.appendChild(a),n.appendChild(o),n.setAttribute("form-name",e.name),!0===e.hasOwnProperty("validations")&&n.setAttribute("form-validations",JSON.stringify(e.validations)),!0===e.hasOwnProperty("optional")&&n.setAttribute("form-optional",Boolean(e.optional)),n},input:function(e,t){var r=document,n=this.__basic_component(e,t),a=r.createElement("div"),o=r.createElement("input"),i=r.createElement("div")
a.className="form-line-group",i.className="form-line-bottom",o.setAttribute("type","text"),o.setAttribute("name",e.name||""),o.setAttribute("size","30"),o.setAttribute("placeholder",e.placeholder||""),o.addEventListener("input",function(){var r=o.value.trim()
t.formObj[e.name]=""===r?null:r},!1),a.appendChild(o),a.appendChild(i)
var s=r.createElement("p")
return s.className="form-error",!0===e.hasOwnProperty("onError")?s.innerHTML=e.onError:s.innerHTML=t._defaultErrorMessage,n.appendChild(a),n.appendChild(s),n},radio:function(e,t){var r=document,n=this.__basic_component(e,t)
r.createElement("ul")
e.hasOwnProperty("items")&&this.__from_items(n,"radio",e,t)
var a=r.createElement("p")
return a.className="form-error",!0===e.hasOwnProperty("onError")?a.innerHTML=e.onError:a.innerHTML=t._defaultErrorMessage,n.appendChild(a),n},checkbox:function(e,t){var r=document,n=this.__basic_component(e,t)
r.createElement("ul")
e.hasOwnProperty("items")&&this.__from_items(n,"checkbox",e,t)
var a=r.createElement("p")
return a.className="form-error",!0===e.hasOwnProperty("onError")?a.innerHTML=e.onError:a.innerHTML=t._defaultErrorMessage,n.appendChild(a),n},radioMatrix:function(e,t){var r=document,n=this.__basic_component(e,t),a=r.createElement("table"),o=r.createElement("tr")
o.appendChild(r.createElement("th"))
for(var i=0;i<e.cols.length;i+=1){var s=r.createElement("th")
s.innerHTML=e.cols[i].title||"",o.appendChild(s)}a.appendChild(o),this.__from_matrix(a,"radio",e,t,e.requirements||[])
var l=r.createElement("p")
return l.className="form-error",!0===e.hasOwnProperty("onError")?l.innerHTML=e.onError:l.innerHTML=t._defaultErrorMessage,n.appendChild(a),n.appendChild(l),n},checkboxMatrix:function(e,t){var r=document,n=this.__basic_component(e,t),a=r.createElement("table"),o=r.createElement("tr")
o.appendChild(r.createElement("th"))
for(var i=0;i<e.cols.length;i+=1){var s=r.createElement("th")
s.innerHTML=e.cols[i].title||"",o.appendChild(s)}a.appendChild(o),this.__from_matrix(a,"checkbox",e,t,e.requirements||[])
var l=r.createElement("p")
return l.className="form-error",!0===e.hasOwnProperty("onError")?l.innerHTML=e.onError:l.innerHTML=t._defaultErrorMessage,n.appendChild(a),n.appendChild(l),n},plainText:function(e,t){var r=document,n=this.__basic_component(e,t),a=r.createElement("div")
return a.className="form-plain-text-body",a.innerHTML=e.content,n.appendChild(a),n}},Form.VALIDATIONS={number:function(e,t){if(t=t||[],null===e||void 0===e)return!1
var r,n,a,o
if("string"==typeof e){if(a=parseFloat(e),!0===isNaN(a))return!1
for(;;){if(!((o=t.indexOf("integer"))>-1))break
if(t.splice(o,1),a!=~~a)return!1}for(var i=0;i<t.length;i+=1){if(t[i]=t[i].trim(),!0===/^>/.test(t[i]))if(!0===/^>=/.test(t[i])){if(r=parseFloat(t[i].substr(2,t[i].length)),a<r)return!1}else if(r=parseFloat(t[i].substr(1,t[i].length)),a<=r)return!1
if(!0===/^</.test(t[i]))if(!0===/^<=/.test(t[i])){if(r=parseFloat(t[i].substr(2,t[i].length)),a>r)return!1}else if(r=parseFloat(t[i].substr(1,t[i].length)),a>=r)return!1
if(!0===/^==/.test(t[i])&&(r=parseFloat(t[i].substr(2,t[i].length)))!=a)return!1
if(!0===/^!=/.test(t[i])&&(r=parseFloat(t[i].substr(2,t[i].length)))===a)return!1
if(!0===/:/.test(t[i]))if(!0===/^!/.test(t[i])){var s=t[i].substr(1,t[i].length).split(":")
if(2===s.length&&(r=parseFloat(s[0]),n=parseFloat(s[1]),r<=a&&a<=n))return!1}else{var s=t[i].split(":")
if(2===s.length&&(r=parseFloat(s[0]),n=parseFloat(s[1]),r>a||a>n))return!1}}return!0}return"number"==typeof e},text:function(e,t){t=t||[]
for(var r,n=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,a=/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \?=.-]*)*\/?$/,o=0;o<t.length;o+=1){if(t[o]=t[o].trim(),!0===/^(not)?contains/.test(t[o])&&(r=t[o].split(":"),r.shift(),""!==(r=r.join(":"))))return!0===/^not/.test(t[o])?-1===e.indexOf(r):e.indexOf(r)>-1
if("email"===t[o]&&!1===n.test(e))return!1
if("url"===t[o]&&!1===a.test(e))return!1}return!0},regexp:function(e,t){for(var r,n=0;n<t.length;n+=1)if(r=RegExp(t[n]),!1===r.test(e))return!1
return!0},length:function(e,t){return t=t||{},!(!0===t.hasOwnProperty("min")&&(t.min=~~t.min,t.min>=0&&e.length<t.min))&&!(!0===t.hasOwnProperty("max")&&(t.max=~~t.max,t.max>=0&&e.length>t.max))}},Form.prototype.validate=function(e,t){return!0!==Form.VALIDATIONS.hasOwnProperty(e.type)||Form.VALIDATIONS[e.type].call(this,t,e.list||[])},Form.prototype.addValidation=function(e,t){return"string"==typeof e&&""!==(e=e.trim())&&"function"==typeof t&&(Form.VALIDATIONS[e]=t,!0)},Form.prototype.on=function(e,t){var r=this
"string"==typeof e&&"function"==typeof t&&r._events.indexOf(e)>-1&&(r._callbacs[e].push(t),r._triggeredEvents.indexOf(e)>-1&&t.apply(r,r._lastArgumentOf[e]))},Form.prototype.triggerEvent=function(e){var t,r=this,n=Array.from(arguments).slice(1,arguments.length)
if(r._events.indexOf(e)>-1)if(-1===r._triggeredEvents.indexOf(e))for(r._triggeredEvents.push(e),r._lastArgumentOf[e]=n,t=0;t<r._callbacs[e].length;t+=1)r._callbacs[e][t].apply(r,n)
else for(0===n.length&&(n=r._lastArgumentOf[e]),n!=r._lastArgumentOf[e]&&(r._lastArgumentOf[e]=n),t=0;t<r._callbacs[e].length;t+=1)r._callbacs[e][t].apply(r,n)},Form.prototype.setTarget=function(e){if(!(e instanceof HTMLDivElement))throw new TypeError("First element must be a <div> element")
this._target=e},Form.prototype.setSource=function(e){var t=this,r=new XMLHttpRequest
r.open("GET",e,!0),r.addEventListener("load",function(e){if(4===e.target.readyState&&e.target.status<400){var r=JSON.parse(e.target.responseText)
return t._obj=r,t.triggerEvent("load",r),void t.compile()}throw new Error("Error while loading the data")},!1),r.send(null)},Form.prototype.createComponent=function(e,t){var r=document.createElement("div")
return r.className="form-"+e,!0===Form._components.hasOwnProperty(e)?Form._components[e](t,this):r},Form.prototype.nextPage=function(){this.goToPage(this._currentPage+1)},Form.prototype.prevPage=function(){this.goToPage(this._currentPage-1)},Form.prototype.goToPage=function(e){if((e=~~e)<0)throw new TypeError("Expected a non-negative number as page index.")
if(null==this._target)throw new ReferenceError("Target element not found")
var t=this._target.querySelectorAll(".form-page"),r=this._target.querySelector(".form-next-page"),n=this._target.querySelector(".form-prev-page"),a=this._target.querySelector(".form-submit")
if(!t)throw new ReferenceError("No page found")
if(!(t.length>e))throw new ReferenceError("Page #"+e+" not found")
this._currentPage=e,this._currentPage+1<t.length?(r.classList.remove("form-hidden"),a.classList.add("form-hidden")):(r.classList.add("form-hidden"),a.classList.remove("form-hidden")),this._currentPage-1>=0?n.classList.remove("form-hidden"):n.classList.add("form-hidden")
for(var o=0;o<t.length;o+=1)o!=e?t[o].classList.add("form-hidden"):t[o].classList.remove("form-hidden")},Form.prototype.pageComplete=function(){var e=this,t=e._currentPage,r=document,n=function(t,a,o){for(var i,s,l=!0,m=0;m<t.length;m+=1){if(i=!0,"string"==typeof t[m]?(s=t[m],!1===a.hasOwnProperty(t[m])?i=!1:!1===Boolean(a[t[m]])&&(i=!1)):(s=t[m].name,i=n(t[m].requirements,a[t[m].name],o+1)),0===o&&"string"==typeof t[m]){var c=r.querySelector('[form-name="'+s+'"]'),p=c.getAttribute("form-validations"),f=!!c.getAttribute("form-optional")
if(null!=p)if(p=JSON.parse(p),!1===i)i=f
else for(var d=0;d<p.length&&!0===i;d+=1)!1===e.validate(p[d],a[t[m]])&&(i=!1)
else"_"!==s&&!0!==f||(i=!0)}!1===i&&0===o?r.querySelector('[form-name="'+s+'"]').classList.add("form-incomplete"):!0===i&&0===o&&r.querySelector('[form-name="'+s+'"]').classList.remove("form-incomplete"),l=l&&i}return l}
return n(e._pageRequirements[t],e.formObj,0)},Form.prototype.compile=function(){if(null==this._target)throw new ReferenceError("Target element not found")
var e=this,t=e._target,r=0,n=document
t.innerHTML=""
var a=n.createElement("ul")
a.className="form-pagelist"
!function t(a,o){for(var i=Object.keys(o),s=a,l=0;l<i.length;l+=1)if("type"===i[l])if("page"===o.type){e._pageRequirements[r]=[],r+=1,e._pages=r
var m=n.createElement("li"),c=n.createElement("h2"),p=n.createElement("p")
m.className="form-page",c.className="form-page-header form-title",p.className="form-page-subtitle form-subtitle",c.innerHTML=o.title,p.innerHTML=o.subtitle,m.appendChild(c),m.appendChild(p),s.appendChild(m),s=m}else e._componentList.indexOf(o.type)>-1&&s.appendChild(e.createComponent(o.type,o))
else if("items"===i[l])for(var f=0;f<o.items.length;f+=1)t(s,o.items[f])}(a,e._obj),t.appendChild(a)
var o=n.createElement("div"),i=n.createElement("button"),s=n.createElement("button"),l=n.createElement("button")
i.innerHTML="Previous",s.innerHTML="Next",l.innerHTML="Submit",o.className="form-btn-container",s.className="form-next-page",i.className="form-prev-page",l.className="form-submit",i.addEventListener("click",function(){e.prevPage()},!1),s.addEventListener("click",function(){!0===e.pageComplete()&&e.nextPage()},!1),l.addEventListener("click",function(){!0===e.pageComplete()&&e.triggerEvent("completed",e.formObj)},!1),o.appendChild(i),o.appendChild(s),o.appendChild(l),o.appendChild(l),a.appendChild(o),e.goToPage(0)}
